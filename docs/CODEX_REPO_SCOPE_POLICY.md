# Codex Repository Scope Policy (WebKurier)

## 0) Назначение
Этот документ фиксирует правило безопасности: Codex (в CI / automation) имеет право сканировать только тот репозиторий, в котором он запущен, и не должен получать доступ к другим репозиториям экосистемы без явного решения владельца и формального разрешения.

## 1) Базовое правило (Repo-Local Scope)
**Codex MUST operate in repo-local scope.**

Это означает:
- Codex сканирует только текущий репозиторий в workspace CI (например, `/workspace/<repo>`).
- Codex не должен “переходить” в другие репозитории.
- Любой анализ, поиск, чтение файлов допускается только в пределах текущего checkout.

## 2) Разрешённые действия (в рамках текущего репо)
Разрешено:
- `ls`, `find`, `cat`, `rg/grep` внутри репозитория
- чтение файлов конфигурации и документации репозитория
- генерация документации (docs/*) и отчётов
- создание PR/patch только при включённом режиме изменения (если проектом разрешено)

Запрещено:
- попытки читать файлы за пределами workspace репозитория
- обращение к секретам и их логирование
- любые сетевые запросы к сторонним ресурсам без явного разрешения Security
- любые действия, приводящие к созданию/модификации секретов

## 3) Что считается нарушением Repo-Local Scope
Нарушением считается:
- checkout дополнительных репозиториев без утверждённой процедуры
- использование GitHub token с правами на org-wide чтение реп
- использование API GitHub для обхода репозиториев организации
- использование submodule/monorepo как “туннеля” для доступа к другим доменам без Security gate

## 4) Multi-Repo доступ — только через явную процедуру
Если требуется анализ нескольких репозиториев:
- используется отдельный orchestrator workflow (обычно в WebKurierHybrid)
- применяется принцип **least privilege**
- токен ограничивается списком разрешённых репозиториев (allowlist)
- результаты проходят аудит и логируются (Chain/Security audit)

## 5) Модель доверия и границы ответственности (обязательная)
- **Trusted:** WebKurierHybrid (оркестратор), WebKurierCore (router), WebKurierChain (integrity), WebKurierSecurity (controls)
- **Semi-trusted:** Domain Hubs (PhoneCore/VehicleHub/DroneHybrid)
- **Untrusted:** внешние клиенты, браузеры, мобильные приложения, любые произвольные ссылки

Codex не должен обходить WebKurierChain integrity и WebKurierSecurity validation.

## 6) Сохранение доказательств (Audit)
Каждый запуск Codex должен:
- фиксировать идентификатор workflow run / job
- фиксировать репозиторий и commit SHA
- фиксировать список команд (без секретов)
- сохранять отчёт (docs/report) или job summary

## 7) Enforcement (как обеспечивается)
Минимально:
- `actions/checkout` выполняется для одного репозитория
- `permissions:` ограничены (contents: read)
- отсутствие PAT с org-wide scope
- запрет на дополнительные checkout без ручного подтверждения владельца

Рекомендуемо:
- отдельный Security job, который валидирует permissions/checkout list
- блокировка workflow при обнаружении multi-repo checkout без allowlist

## 8) Изменения политики
Любые изменения этого документа:
- проходят review владельцем (owner)
- фиксируются в Chain (audit record) при наличии WebKurierChain интеграции
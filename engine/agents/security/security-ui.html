<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WebKurierSecurity ‚Äî UI</title>
  <style>
    :root { --pad:14px; --radius:14px; --gap:10px; }
    html, body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0f14; color:#e8eef6; }
    header { padding: var(--pad); position:sticky; top:0; background: #0b0f14cc; backdrop-filter: blur(6px); border-bottom: 1px solid #1e2937; }
    h1 { margin:0 0 6px; font-size:20px; }
    .grid { display:grid; grid-template-columns: 1fr; gap: var(--gap); padding: var(--pad); }
    @media (min-width: 720px){ .grid { grid-template-columns: 1fr 1fr; } }
    .card { background:#0f1722; border:1px solid #1e2937; border-radius: var(--radius); padding: var(--pad); }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    input, textarea, select {
      background:#0b1220; color:#e8eef6; border:1px solid #223047; border-radius:12px; padding:10px 12px; width:100%;
      outline:none;
    }
    textarea { min-height: 90px; }
    .btn {
      appearance:none; border:1px solid #2b3b54; background:#152034; color:#e8eef6; padding:10px 14px; border-radius:12px;
      cursor:pointer; font-weight:600;
    }
    .btn:active { transform: translateY(1px); }
    .btn.primary { background:#1b3b7a; border-color:#325aa3; }
    .muted { color:#87a0c2; font-size:12px; }
    .ok { color:#6fe3a8; }
    .warn { color:#ffd36b; }
    .bad { color:#ff7b7b; }
    pre {
      background:#0b1220; color:#d5e1f7; border:1px solid #223047; border-radius:12px; padding:12px; overflow:auto; max-height:40vh;
    }
    .badge { font-size:12px; padding:4px 8px; border-radius:999px; background:#132136; border:1px solid #223047; }
    .split { display:flex; gap:8px; }
    .split > * { flex:1; }
  </style>
</head>
<body>
  <header>
    <h1>üõ° WebKurierSecurity ‚Äî –ø–∞–Ω–µ–ª—å</h1>
    <div class="muted">–£–ø—Ä–∞–≤–ª—è–π –∞–≥–µ–Ω—Ç–æ–º: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, firewall, —Ç–æ–∫–µ–Ω—ã –∏ –æ—Ç—á—ë—Ç—ã.</div>
  </header>

  <main class="grid">
    <!-- SCAN -->
    <section class="card">
      <h3>üîç –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
      <div class="row">
        <input id="scanPath" placeholder="–ü—É—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Ç–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞)" />
      </div>
      <div class="row">
        <button class="btn primary" onclick="sendCmd('/scan ' + (gid('scanPath').value||''))">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫–∞–Ω</button>
      </div>
      <div class="muted">–°–æ–≤–µ—Ç: –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º ‚Äî –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.</div>
    </section>

    <!-- MONITOR -->
    <section class="card">
      <h3>üì° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h3>
      <div class="row split">
        <input id="monPath" placeholder="–ü—É—Ç—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)" />
      </div>
      <div class="row">
        <button class="btn" onclick="sendCmd('/monitor start ' + (gid('monPath').value||''))">Start</button>
        <button class="btn" onclick="sendCmd('/monitor stop')">Stop</button>
      </div>
      <div class="muted">–õ–æ–≥–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±—É–¥—É—Ç –ø–µ—á–∞—Ç–∞—Ç—å—Å—è –≤ stdout —Å–µ—Ä–≤–µ—Ä–∞.</div>
    </section>

    <!-- FIREWALL -->
    <section class="card">
      <h3>üö´ Firewall (IP blacklist)</h3>
      <div class="row split">
        <input id="fwIp" placeholder="IP (–Ω–∞–ø—Ä–∏–º–µ—Ä 1.2.3.4)" />
      </div>
      <div class="row">
        <button class="btn" onclick="sendCmd('/firewall add ' + gid('fwIp').value)">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="btn" onclick="sendCmd('/firewall remove ' + gid('fwIp').value)">–£–¥–∞–ª–∏—Ç—å</button>
        <button class="btn" onclick="sendCmd('/firewall list')">–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫</button>
      </div>
      <div class="muted">–°–ø–∏—Å–æ–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ <code>engine/agents/security/firewall/blocklist.json</code>.</div>
    </section>

    <!-- TOKENS -->
    <section class="card">
      <h3>üîë –¢–æ–∫–µ–Ω—ã</h3>
      <div class="row">
        <button class="btn primary" onclick="sendCmd('/tokens rotate')">–†–æ—Ç–∞—Ü–∏—è/—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ *_token</button>
      </div>
      <div class="muted">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ AES‚Äë256, –∫–ª—é—á –≤ <code>config.json ‚Üí crypto.aes256_key_hex</code>.</div>
    </section>

    <!-- REPORT -->
    <section class="card">
      <h3>üìÑ –û—Ç—á—ë—Ç—ã</h3>
      <div class="row">
        <button class="btn" onclick="sendCmd('/report make')">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å PDF</button>
        <button class="btn" onclick="sendCmd('/report send')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram</button>
      </div>
      <div class="muted">–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á—ë—Ç: <code>engine/agents/security/report/last-security-report.pdf</code>.</div>
    </section>

    <!-- CONSOLE -->
    <section class="card" style="grid-column: 1 / -1;">
      <h3>üí¨ –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∞–≥–µ–Ω—Ç–∞</h3>
      <div class="row">
        <input id="rawCmd" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: /scan ./engine" />
        <button class="btn" onclick="sendCmd(gid('rawCmd').value)">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
      </div>
      <div class="row">
        <span class="badge" id="status">–ì–æ—Ç–æ–≤</span>
      </div>
      <pre id="out" aria-live="polite">–í—ã–≤–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å‚Ä¶</pre>
      <div class="muted">–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å <code>security-agent.js</code> (handleCommand).</div>
    </section>
  </main>

  <script>
    const API_ENDPOINT = '/api/security/handle'; 
    // üëÜ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é UI —à–ª—ë—Ç POST –Ω–∞ —ç—Ç–æ—Ç –ø—É—Ç—å —Å JSON { cmd: "/scan ..." }.
    // –ï—Å–ª–∏ —É —Ç–µ–±—è –¥—Ä—É–≥–æ–π –º–∞—Ä—à—Ä—É—Ç ‚Äî –ø–æ–º–µ–Ω—è–π —Å—Ç—Ä–æ–∫—É –≤—ã—à–µ.

    const gid = id => document.getElementById(id);
    const out = gid('out');
    const status = gid('status');

    async function sendCmd(cmd) {
      if (!cmd || !cmd.trim()) return;
      setStatus('–í—ã–ø–æ–ª–Ω—è—é‚Ä¶', 'warn');

      try {
        const res = await fetch(API_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ cmd })
        });
        const data = await res.json().catch(() => ({}));

        const pretty = JSON.stringify(data, null, 2);
        out.textContent = pretty || '–ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –Ω–æ –æ—Ç–≤–µ—Ç –ø—É—Å—Ç.';
        setStatus(res.ok ? 'OK' : `–û—à–∏–±–∫–∞ HTTP ${res.status}`, res.ok ? 'ok' : 'bad');
      } catch (e) {
        setStatus('–°–µ—Ç—å/—Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'bad');
        out.textContent = String(e);
      }
    }

    function setStatus(text, kind='muted') {
      status.className = 'badge ' + (kind || '');
      status.textContent = text;
    }
  </script>
</body>
</html>
